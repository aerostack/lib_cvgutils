/************************************
* Dynamic Matrix Control - SISO Controller
*
* DMC.h
* DMC.cpp
*
* Author:				Miguel Gómez Gonzalez
* Property:				CVG-CAR-UPM
*
*
* Version:					1.0
*
* Creation Date:			29/07/2014
* Last Modification Date:	--
*
****************************************/

//Libreria opencv
#include <opencv2/opencv.hpp>
#include "opencv2/core/core.hpp"

// C++ libraries
#include <iostream>
#include <string>

using namespace cv;
using namespace std;

int main(){

    int T;
    int N;
    double alfa;

    /* // test system: G(s) = 1/(1+s);
    Mat su = (Mat_<double>(22,1) << 0.3935, 0.6321, 0.7769, 0.8647, 0.9179, 0.9502, 0.9698, 0.9817, 0.9889, 0.9933, 0.9959, 0.9975, 0.9985, 0.9991, 0.9994, 0.9997, 0.9998, 0.9999, 0.9999, 1.0, 1.0, 1.0);
    //std::cout << "su.size, height:" << su.size().height << " width:" << su.size().width << std::endl;
    T      = 30;
    N      = su.size().height;
    alfa   = 1.0;

    Mat ym= (Mat_<double>(51,1) << 0,0.286419312605914,0.582855584008431,0.797606156445473,0.924594857252443,0.987005545881916,1.01078572776031,1.01533925638737,1.01240926707115,1.00791333791356,1.00420184847421,1.00180551328698,1.00051821261345,0.999956049164126,0.999787943556078,0.999794618966844,0.999855539583120,0.999916439690212,0.999959922138682,0.999985472818474,0.999998230452421,1.00000377640483,1.00000630292479,1.00000826761084,1.00000900567748,1.00000827400086,1.00000654052210,1.00000449444593,1.00000266728539,1.00000131439647,1.00000046353203,1.00000001687753,0.999999839372743,0.999999811186390,0.999999847821966,0.999999900014281,0.999999944841460,0.999999975459982,0.999999992944806,1.00000000109030,1.00000000372325,1.00000000368348,1.00000000270323,1.00000000165371,1.00000000086181,1.00000000036856,1.00000000009940,0.999999999968654,0.999999999915048,0.999999999902424,0.999999999910750);
    Mat um= (Mat_<double>(51,1) << 0,0.727932988112189,1.03981034222468,1.12864289307856,1.12034718809542,1.08321125309130,1.04744273740750,1.02235849382066,1.00789270587829,1.00098288972163,0.998480609466058,0.998111576776092,0.998533846242748,0.999089477533578,0.999528809756031,0.999804909073038,0.999949448352615,1.00001031684492,1.00002695007569,1.00002485904018,1.00001789626966,1.00001232545764,1.00001019754037,1.00001129616277,1.00001014340284,1.00000714612566,1.00000386837485,1.00000134043163,0.999999850728237,0.999999228926193,0.999999151929533,0.999999328362270,0.999999565750160,0.999999767737293,0.999999904295489,0.999999980468426,1.00000001394229,1.00000002265825,1.00000001989756,1.00000001364654,1.00000000778193,1.00000000362218,1.00000000119217,1.00000000003587,0.999999999641115,0.999999999608210,0.999999999684506,0.999999999767103,0.999999999832416,0.999999999882964,0.999999999923583);

    Mat ym2= (Mat_<double>(101,1) << 0,0.286419312605914,0.582855584008431,0.797606156445473,0.924594857252443,0.987005545881916,1.01078572776031,1.01533925638737,1.01240926707115,1.00791333791356,1.00420184847421,1.00180551328698,1.00051821261345,0.999956049164126,0.999787943556078,0.999794618966844,0.999855539583120,0.999916439690212,0.999959922138682,0.999985472818474,0.999998230452421,1.00000377640483,1.00000630292479,1.00000826761084,1.00000900567748,1.00000827400086,1.00000654052210,1.00000449444593,1.00000266728539,1.00000131439647,1.00000046353203,1.00000001687753,0.999999839372743,0.999999811186390,0.999999847821966,0.999999900014281,0.999999944841460,0.999999975459982,0.999999992944806,1.00000000109030,1.00000000372325,1.00000000368348,1.00000000270323,1.00000000165371,1.00000000086181,1.00000000036856,1.00000000009940,0.999999999968654,0.999999999915048,0.999999999902424,0.828148412364984,0.650286649543693,0.521436306099899,0.445243085630235,0.407796672462608,0.393528563341645,0.390796446168462,0.392554439759290,0.395251997253851,0.397478890917011,0.398916692028810,0.399689072432481,0.400026370501765,0.400127233866415,0.400123228619872,0.400086676250079,0.400050136185826,0.400024046716756,0.400008716308894,0.400001061728536,0.399997734157099,0.399996218245122,0.399995039433493,0.399994596593511,0.399995035599488,0.399996075686743,0.399997303332442,0.399998399628765,0.399999211362120,0.399999721880783,0.399999989873481,0.400000096376355,0.400000113288167,0.400000091306821,0.400000059991432,0.400000033095124,0.400000014724010,0.400000004233116,0.399999999345818,0.399999997766049,0.399999997789909,0.399999998378063,0.399999999007777,0.399999999482912,0.399999999778865,0.399999999940357,0.400000000018808,0.400000000050971,0.400000000058546,0.400000000053550,0.400000000042880);
    Mat um2= (Mat_<double>(101,1) << 0,0.727932988112189,1.03981034222468,1.12864289307856,1.12034718809542,1.08321125309130,1.04744273740750,1.02235849382066,1.00789270587829,1.00098288972163,0.998480609466058,0.998111576776092,0.998533846242748,0.999089477533578,0.999528809756031,0.999804909073038,0.999949448352615,1.00001031684492,1.00002695007569,1.00002485904018,1.00001789626966,1.00001232545764,1.00001019754037,1.00001129616277,1.00001014340284,1.00000714612566,1.00000386837485,1.00000134043163,0.999999850728237,0.999999228926193,0.999999151929533,0.999999328362270,0.999999565750160,0.999999767737293,0.999999904295489,0.999999980468426,1.00000001394229,1.00000002265825,1.00000001989756,1.00000001364654,1.00000000778193,1.00000000362218,1.00000000119217,1.00000000003587,0.999999999641115,0.999999999608210,0.999999999684506,0.999999999767103,0.999999999832416,0.999999999882964,0.563240207088631,0.376113794645110,0.322814264148457,0.327791687146826,0.350073248152483,0.371534357562691,0.386584903713204,0.395264376476687,0.399410266169021,0.400911634321209,0.401133053934514,0.400879692254206,0.400546313479618,0.400282714146168,0.400117054556025,0.400030330988341,0.399993809893004,0.399983829954568,0.399985084575891,0.399989262238210,0.399992604725421,0.399993881475780,0.399993222302343,0.399993913958298,0.399995712324603,0.399997678975093,0.399999195741024,0.400000089563058,0.400000462644284,0.400000508842281,0.400000402982638,0.400000260549905,0.400000139357625,0.400000057422706,0.400000011718944,0.399999991634626,0.399999986405047,0.399999988061466,0.399999991812076,0.399999995330844,0.399999997826690,0.399999999284699,0.399999999978477,0.400000000215331,0.400000000235074,0.400000000189297,0.400000000139739,0.400000000100551,0.400000000070221,0.400000000045850,0.400000000026433);

    { // Write to file
    FileStorage fs("dmc_altitude_controller_configuration.yml", FileStorage::WRITE);
    fs << "T_control_horizon"            << T;
    fs << "N"                            << N;
    fs << "su"                           << su;
    fs << "alpha_response_time_parameter" << alfa;
    fs << "measured_output"              << ym;  //measured output with reference=1
    fs << "control moves"                << um;
    fs << "measured_output_2"            << ym2; //measured output with reference =1 changing to reference=0.4 in time=50
    fs << "control_moves_2"              << um2;
    fs.release();
    } // ~FileStorage();
    */


        // Pelican Quadrotor
        {
        // Ts = 0.1, Tau_thruster = 0.5, m = 2.11, Kfr = 0.15, THRUST_MAX_VALUE = 32
        //Mat su = (Mat_<double>(471,1) << 0.141352380730987,0.528051986384994,1.11179951451874,1.85310484555338,2.71968944642435,3.68517838008172,4.72802942405461,5.83065631734848,6.97871094603081,8.16049565666327,9.36648210926006,10.5889173572913,11.8215013430109,13.0591228625699,14.2976434020050,15.5337201664512,16.7646611979209,17.9883067648494,19.2029322610140,20.4071687147144,21.5999377158898,22.7803981475212,23.9479025814455,25.1019615865993,26.2422145152968,27.3684055931554,28.4803643511680,29.5779896127109,30.6612363909756,31.7301051691450,32.7846331312873,33.8248869902561,34.8509571230039,35.8629527762112,36.8609981481139,37.8452291876010,38.8157909804639,39.7728356162672,40.7165204486230,41.6470066774606,42.5644581948317,43.4690406463864,44.3609206693350,45.2402652748146,46.1072413483954,46.9620152472245,47.8047524762039,48.6356174287909,49.4547731806242,50.2623813263164,51.0586018515075,51.8435930337078,52.6175113666320,53.3805115036886,54.1327462170753,54.8743663695767,55.6055208966858,56.3263567971055,57.0370191300374,57.7376510179577,58.4283936538130,59.1093863117666,59.7807663607833,60.4426692804699,61.0952286786958,61.7385763106065,62.3728420987114,62.9981541537880,63.6146387963918,64.2224205787996,64.8216223072465,65.4123650643436,65.9947682315831,66.5689495118580,67.1350249519341,67.6931089648275,68.2433143520475,68.7857523256750,69.3205325302501,69.8477630644518,70.3675505025517,70.8799999156335,71.3852148925659,71.8832975607258,72.3743486064650,72.8584672953173,73.3357514919465,73.8062976798315,74.2702009806908,74.7275551736460,75.1784527141258,75.6229847525124,76.0612411525316,76.4933105093899,76.9192801676604,77.3392362389196,77.7532636191397,78.1614460058371,78.5638659149815,78.9606046976680,79.3517425565553,79.7373585620735,80.1175306684031,80.4923357292303,80.8618495132800,81.2261467196300,81.5853009928096,81.9393849376859,82.2884701341390,82.6326271515318,82.9719255629745,83.3064339593885,83.6362199633717,83.9613502428684,84.2818905246458,84.5979056075810,84.9094593757599,85.2166148113916,85.5194340075402,85.8179781806772,86.1123076830566,86.4024820149154,86.6885598365015,86.9705989799324,87.2486564608860,87.5227884901267,87.7930504848686,88.0594970799784,88.3221821390199,88.5811587651432,88.8364793118193,89.0881953934237,89.3363578956708,89.5810169859004,89.8222221232194,90.0600220685003,90.2944648942381,90.5255979942688,90.7534680933503,90.9781212566077,91.1996028988458,91.4179577937302,91.6332300828379,91.8454632845814,92.0547003030058,92.2609834364622,92.4643543861585,92.6648542645894,92.8625236038479,93.0574023638184,93.2495299402555,93.4389451727477,93.6256863525689,93.8097912304195,93.9912970240577,94.1702404258234,94.3466576100555,94.5205842404051,94.6920554770447,94.8611059837763,95.0277699350387,95.1920810228161,95.3540724634492,95.5137770043499,95.6712269306214,95.8264540715849,95.9794898072141,96.1303650744784,96.2791103735976,96.4257557742072,96.5703309214374,96.7128650419057,96.8533869496257,96.9919250518317,97.1285073547212,97.2631614691169,97.3959146160480,97.5267936322534,97.6558249756067,97.7830347304647,97.9084486129408,98.0320919761033,98.1539898151009,98.2741667722156,98.3926471418439,98.5094548754086,98.6246135862004,98.7381465541513,98.8500767305410,98.9604267426366,99.0692188982668,99.1764751903314,99.2822173012476,99.3864666073328,99.4892441831262,99.5905708056491,99.6904669586050,99.7889528365207,99.8860483488284,99.9817731238906,100.076146512968,100.169187594133,100.260915176123,100.351347802145,100.440503753625,100.528401053903,100.615057471874,100.700490525584,100.784717485769,100.867755379347,100.949620992860,101.030330875867,101.109901344290,101.188348483713,101.265688152635,101.341935985669,101.417107396714,101.491217582059,101.564281523465,101.636313991187,101.707329546963,101.777342546956,101.846367144659,101.914417293752,101.981506750929,102.047649078669,102.112857647991,102.177145641144,102.240526054280,102.303011700080,102.364615210342,102.425349038536,102.485225462320,102.544256586026,102.602454343102,102.659830498526,102.716396651188,102.772164236228,102.827144527355,102.881348639119,102.934787529164,102.987472000440,103.039412703386,103.090620138084,103.141104656386,103.190876463997,103.239945622548,103.288322051625,103.336015530774,103.383035701479,103.429392069114,103.475094004858,103.520150747595,103.564571405780,103.608364959281,103.651540261191,103.694106039623,103.736070899470,103.777443324146,103.818231677303,103.858444204517,103.898089034961,103.937174183043,103.975707550028,104.013696925638,104.051149989621,104.088074313311,104.124477361150,104.160366492204,104.195748961647,104.230631922230,104.265022425725,104.298927424350,104.332353772177,104.365308226517,104.397797449283,104.429828008341,104.461406378835,104.492538944497,104.523231998936,104.553491746914,104.583324305595,104.612735705786,104.641731893155,104.670318729433,104.698501993595,104.726287383037,104.753680514718,104.780686926303,104.807312077278,104.833561350057,104.859440051065,104.884953411817,104.910106589971,104.934904670374,104.959352666086,104.983455519396,105.007218102821,105.030645220092,105.053741607122,105.076511932965,105.098960800762,105.121092748668,105.142912250770,105.164423717996,105.185631498999,105.206539881043,105.227153090866,105.247475295536,105.267510603291,105.287263064375,105.306736671848,105.325935362403,105.344863017154,105.363523462425,105.381920470523,105.400057760498,105.417938998897,105.435567800506,105.452947729079,105.470082298058,105.486974971286,105.503629163705,105.520048242046,105.536235525511,105.552194286443,105.567927750990,105.583439099753,105.598731468431,105.613807948457,105.628671587619,105.643325390680,105.657772319981,105.672015296045,105.686057198163,105.699900864978,105.713549095061,105.727004647471,105.740270242319,105.753348561313,105.766242248304,105.778953909818,105.791486115582,105.803841399048,105.816022257900,105.828031154563,105.839870516697,105.851542737690,105.863050177143,105.874395161345,105.885579983744,105.896606905408,105.907478155488,105.918195931664,105.928762400589,105.939179698330,105.949449930799,105.959575174175,105.969557475331,105.979398852238,105.989101294385,105.998666763168,106.008097192298,106.017394488185,106.026560530325,106.035597171682,106.044506239060,106.053289533473,106.061948830509,106.070485880690,106.078902409827,106.087200119363,106.095380686723,106.103445765653,106.111396986550,106.119235956794,106.126964261073,106.134583461706,106.142095098952,106.149500691329,106.156801735915,106.163999708654,106.171096064655,106.178092238482,106.184989644448,106.191789676900,106.198493710499,106.205103100501,106.211619183029,106.218043275342,106.224376676104,106.230620665645,106.236776506220,106.242845442264,106.248828700645,106.254727490907,106.260543005524,106.266276420132,106.271928893769,106.277501569113,106.282995572710,106.288412015200,106.293751991546,106.299016581252,106.304206848581,106.309323842774,106.314368598257,106.319342134854,106.324245457991,106.329079558900,106.333845414821,106.338543989195,106.343176231864,106.347743079260,106.352245454594,106.356684268046,106.361060416944,106.365374785950,106.369628247236,106.373821660661,106.377955873946,106.382031722843,106.386050031306,106.390011611657,106.393917264751,106.397767780135,106.401563936211,106.405306500392,106.408996229257,106.412633868703,106.416220154098,106.419755810429,106.423241552446,106.426678084811,106.430066102236,106.433406289628,106.436699322221,106.439945865720,106.443146576430,106.446302101392,106.449413078512,106.452480136689,106.455503895945,106.458484967550,106.461423954142,106.464321449852,106.467178040425,106.469994303335,106.472770807904,106.475508115417,106.478206779235,106.480867344907,106.483490350281,106.486076325609,106.488625793662,106.491139269826,106.493617262214,106.496060271766,106.498468792347,106.500843310854,106.503184307308,106.505492254953,106.507767620352,106.510010863483,106.512222437829,106.514402790471,106.516552362179,106.518671587500,106.520760894846,106.522820706582,106.524851439110);
        // Ts = 0.1, Tau_thruster = 0.35, m = 2.11, Kfr = 0.5, THRUST_MAX_VALUE = 32
        //Mat su = (Mat_<double>(126,1) << 0.194261463085655,0.699367082075692,1.42144202168415,2.29071091764823,3.25547299511212,4.27757615547911,5.32901742772151,6.38938978422726,7.44396491096925,8.48225381671196,9.49692646427296,10.4830011384970,11.4372364578224,12.3576756131413,13.2433049497850,14.0937984259599,14.9093265578795,15.6904137798773,16.4378321440681,17.1525222871454,17.8355348485088,18.4879872196202,19.1110317786800,19.7058327221687,20.2735493242211,20.8153239953614,21.3322739182733,21.8254853434250,22.2960098566150,22.7448621027152,23.1730185792471,23.5814172105761,23.9709574864700,24.3425010035378,24.6968722891814,25.0348598185459,25.3572171580892,25.6646641867466,25.9578883586568,26.2375459811508,26.5042634889770,26.7586387011710,27.0012420510290,27.2326177826540,27.4532851097833,27.6637393342489,27.8644529226446,28.0558765406510,28.2384400451190,28.4125534344643,28.5786077582517,28.7369759870675,28.8880138439241,29.0320605985301,29.1694398258109,29.3004601300804,29.4254158362660,29.5445876495685,29.6582432849114,29.7666380674977,29.8700155057504,29.9686078378707,30.0626365532001,30.1523128895275,30.2378383074348,30.3194049427307,30.3971960379741,30.4713863540496,30.5421425627084,30.6096236209557,30.6739811281170,30.7353596663857,30.7938971256130,30.8497250130683,30.9029687488651,30.9537479477146,31.0021766876396,31.0483637662512,31.0924129451647,31.1344231831025,31.1744888582074,31.2126999800669,31.2491423919227,31.2838979635212,31.3170447750375,31.3486572924858,31.3788065350108,31.4075602344358,31.4349829874253,31.4611364006044,31.4860792289615,31.5098675078441,31.5325546788452,31.5541917098620,31.5748272095988,31.5945075367680,31.6132769042379,31.6311774783588,31.6482494736924,31.6645312433550,31.6800593651807,31.6948687238946,31.7089925894839,31.7224626919397,31.7353092925410,31.7475612518374,31.7592460944865,31.7703900710890,31.7810182171622,31.7911544093835,31.8008214192308,31.8100409641394,31.8188337562919,31.8272195491485,31.8352171818247,31.8428446214142,31.8501190033529,31.8570566699142,31.8636732069235,31.8699834787719,31.8760016618100,31.8817412761959,31.8872152162689,31.8924357795172,31.8974146942051,31.9021631457208);
        // Ts = 0.1, Tau_thruster = 0.3, m = 2.11, Kfr = 0.1, THRUST_MAX_VALUE = 32

        Mat su = (Mat_<double>(75,1) << 3.82437963423334,10.3769199151050,17.1748754751720,23.7618078778805,30.0634204210833,36.0770422084178,41.8130047912752,47.2835939903865,52.5009863813213,57.4768816891427,62.2224544740112,66.7483651455863,71.0647812509613,75.1813998139414,79.1074690249708,82.8518089997372,86.4228315906293,89.8285592837569,93.0766432217579,96.1743803924616,99.1287300219433,101.946329208783,104.633507834650,107.196302784706,109.640471509781,111.971504960781,114.194639924392,116.314870787794,118.336960758804,120.265452566673,122.104678667557,123.858770977605,125.531670155519,127.127134455451,128.648748170112,130.099929683068,131.483939148318,132.803885814398,134.062735009465,135.263314803061,136.408322359518,137.500329997275,138.541790967724,139.535044966568,140.482323390062,141.385754347967,142.247367444452,143.069098337710,143.852793088506,144.600212307458,145.313035110328,145.992862890251,146.641222915343,147.259571759789,147.849298576111,148.411728215969,148.948124206514,149.459691588959,149.947579625773,150.412884382556,150.856651190404,151.279876994305,151.683512592820,152.068464774108,152.435598353068,152.785738114190,153.119670664479,153.438146200606,153.741880194261,154.031554999505,154.307821385702,154.571299999517,154.822582759224,155.062234184483,155.29079266456);
        T      = 60;
        N      = su.size().height;
        alfa   = 1.0;

        // Sería mejor poner unos valores acordes al modelo del quadrotor
        Mat ym= (Mat_<double>(51,1) << 0,0.286419312605914,0.582855584008431,0.797606156445473,0.924594857252443,0.987005545881916,1.01078572776031,1.01533925638737,1.01240926707115,1.00791333791356,1.00420184847421,1.00180551328698,1.00051821261345,0.999956049164126,0.999787943556078,0.999794618966844,0.999855539583120,0.999916439690212,0.999959922138682,0.999985472818474,0.999998230452421,1.00000377640483,1.00000630292479,1.00000826761084,1.00000900567748,1.00000827400086,1.00000654052210,1.00000449444593,1.00000266728539,1.00000131439647,1.00000046353203,1.00000001687753,0.999999839372743,0.999999811186390,0.999999847821966,0.999999900014281,0.999999944841460,0.999999975459982,0.999999992944806,1.00000000109030,1.00000000372325,1.00000000368348,1.00000000270323,1.00000000165371,1.00000000086181,1.00000000036856,1.00000000009940,0.999999999968654,0.999999999915048,0.999999999902424,0.999999999910750);
        Mat um= (Mat_<double>(51,1) << 0,0.727932988112189,1.03981034222468,1.12864289307856,1.12034718809542,1.08321125309130,1.04744273740750,1.02235849382066,1.00789270587829,1.00098288972163,0.998480609466058,0.998111576776092,0.998533846242748,0.999089477533578,0.999528809756031,0.999804909073038,0.999949448352615,1.00001031684492,1.00002695007569,1.00002485904018,1.00001789626966,1.00001232545764,1.00001019754037,1.00001129616277,1.00001014340284,1.00000714612566,1.00000386837485,1.00000134043163,0.999999850728237,0.999999228926193,0.999999151929533,0.999999328362270,0.999999565750160,0.999999767737293,0.999999904295489,0.999999980468426,1.00000001394229,1.00000002265825,1.00000001989756,1.00000001364654,1.00000000778193,1.00000000362218,1.00000000119217,1.00000000003587,0.999999999641115,0.999999999608210,0.999999999684506,0.999999999767103,0.999999999832416,0.999999999882964,0.999999999923583);

        Mat ym2= (Mat_<double>(101,1) << 0,0.286419312605914,0.582855584008431,0.797606156445473,0.924594857252443,0.987005545881916,1.01078572776031,1.01533925638737,1.01240926707115,1.00791333791356,1.00420184847421,1.00180551328698,1.00051821261345,0.999956049164126,0.999787943556078,0.999794618966844,0.999855539583120,0.999916439690212,0.999959922138682,0.999985472818474,0.999998230452421,1.00000377640483,1.00000630292479,1.00000826761084,1.00000900567748,1.00000827400086,1.00000654052210,1.00000449444593,1.00000266728539,1.00000131439647,1.00000046353203,1.00000001687753,0.999999839372743,0.999999811186390,0.999999847821966,0.999999900014281,0.999999944841460,0.999999975459982,0.999999992944806,1.00000000109030,1.00000000372325,1.00000000368348,1.00000000270323,1.00000000165371,1.00000000086181,1.00000000036856,1.00000000009940,0.999999999968654,0.999999999915048,0.999999999902424,0.828148412364984,0.650286649543693,0.521436306099899,0.445243085630235,0.407796672462608,0.393528563341645,0.390796446168462,0.392554439759290,0.395251997253851,0.397478890917011,0.398916692028810,0.399689072432481,0.400026370501765,0.400127233866415,0.400123228619872,0.400086676250079,0.400050136185826,0.400024046716756,0.400008716308894,0.400001061728536,0.399997734157099,0.399996218245122,0.399995039433493,0.399994596593511,0.399995035599488,0.399996075686743,0.399997303332442,0.399998399628765,0.399999211362120,0.399999721880783,0.399999989873481,0.400000096376355,0.400000113288167,0.400000091306821,0.400000059991432,0.400000033095124,0.400000014724010,0.400000004233116,0.399999999345818,0.399999997766049,0.399999997789909,0.399999998378063,0.399999999007777,0.399999999482912,0.399999999778865,0.399999999940357,0.400000000018808,0.400000000050971,0.400000000058546,0.400000000053550,0.400000000042880);
        Mat um2= (Mat_<double>(101,1) << 0,0.727932988112189,1.03981034222468,1.12864289307856,1.12034718809542,1.08321125309130,1.04744273740750,1.02235849382066,1.00789270587829,1.00098288972163,0.998480609466058,0.998111576776092,0.998533846242748,0.999089477533578,0.999528809756031,0.999804909073038,0.999949448352615,1.00001031684492,1.00002695007569,1.00002485904018,1.00001789626966,1.00001232545764,1.00001019754037,1.00001129616277,1.00001014340284,1.00000714612566,1.00000386837485,1.00000134043163,0.999999850728237,0.999999228926193,0.999999151929533,0.999999328362270,0.999999565750160,0.999999767737293,0.999999904295489,0.999999980468426,1.00000001394229,1.00000002265825,1.00000001989756,1.00000001364654,1.00000000778193,1.00000000362218,1.00000000119217,1.00000000003587,0.999999999641115,0.999999999608210,0.999999999684506,0.999999999767103,0.999999999832416,0.999999999882964,0.563240207088631,0.376113794645110,0.322814264148457,0.327791687146826,0.350073248152483,0.371534357562691,0.386584903713204,0.395264376476687,0.399410266169021,0.400911634321209,0.401133053934514,0.400879692254206,0.400546313479618,0.400282714146168,0.400117054556025,0.400030330988341,0.399993809893004,0.399983829954568,0.399985084575891,0.399989262238210,0.399992604725421,0.399993881475780,0.399993222302343,0.399993913958298,0.399995712324603,0.399997678975093,0.399999195741024,0.400000089563058,0.400000462644284,0.400000508842281,0.400000402982638,0.400000260549905,0.400000139357625,0.400000057422706,0.400000011718944,0.399999991634626,0.399999986405047,0.399999988061466,0.399999991812076,0.399999995330844,0.399999997826690,0.399999999284699,0.399999999978477,0.400000000215331,0.400000000235074,0.400000000189297,0.400000000139739,0.400000000100551,0.400000000070221,0.400000000045850,0.400000000026433);


        { // Write to file
        FileStorage fs("dmc_altitude_controller_configuration.yml", FileStorage::WRITE);
        fs << "T_control_horizon"            << T;
        fs << "N"                            << N;
        fs << "su"                           << su;
        fs << "alpha_response_time_parameter" << alfa;

        fs << "measured_output"              << ym;  //measured output with reference=1
        fs << "control moves"                << um;
        fs << "measured_output_2"            << ym2; //measured output with reference =1 changing to reference=0.4 in time=50
        fs << "control_moves_2"              << um2;

        fs.release();
        } // ~FileStorage();
        }

//    // Oktokopter Quadrotor
//    //   not yet done
//    //   "Lo unico que habria que modificar en el archivo donde se definen los parametros del modelo en Matlab, cambiar:
//    //      masa, Kfric, etc."
//    {
//        // Ts = 0.1, Tau_thruster = 0.45, m = 3.065, Kfr = 0.5, THRUST_MAX_VALUE = 49.05
//        Mat su = (Mat_<double>(195,1) << 0.895822567631273,2.34758365518441,3.83194152757020,5.27943617267290,6.68198999276551,8.03979020304479,9.35410150464043,10.6262947007867,11.8577165072751,13.0496731653778,14.2034294167703,15.3202095192526,16.4011985016632,17.4475434153524,18.4603545505240,19.4407066142697,20.3896398709398,21.3081612459792,22.1972453943891,23.0578357349457,23.8908454512744,24.6971584608410,25.4776303528876,26.2330892963100,26.9643369184379,27.6721491556527,28.3572770767436,29.0204476798759,29.6623646640191,30.2837091756504,30.8851405315284,31.4672969183025,32.0307960697013,32.5762359220179,33.1041952485876,33.6152342739321,34.1098952682210,34.5887031226817,35.0521659065683,35.5007754062807,35.9350076472050,36.3553233988311,36.7621686636805,37.1559751505657,37.5371607326819,37.9061298910178,38.2632741435558,38.6089724607165,38.9435916674892,39.2674868326750,39.5810016456547,39.8844687810820,40.1782102518889,40.4625377509783,40.7377529819646,41.0041479793161,41.2620054182360,41.5115989146132,41.7531933153593,41.9870449794414,42.2134020499077,42.4325047171957,42.6445854740008,42.8498693619779,43.0485742105359,43.2409108679788,43.4270834252406,43.6072894324479,43.7817201085433,43.9505605441904,44.1139898981757,44.2721815875167,44.4253034714763,44.5735180296811,44.7169825345304,44.8558492180797,44.9902654335768,45.1203738118196,45.2463124125038,45.3682148707197,45.4862105387545,45.6004246233492,45.7109783185573,45.8179889343456,45.9215700210730,46.0218314899806,46.1188797298195,46.2128177197417,46.3037451385726,46.3917584705813,46.4769511078613,46.5594134494302,46.6392329971534,46.7164944485930,46.7912797868821,46.8636683677178,46.9337370035665,47.0015600451709,47.0672094604442,47.1307549108365,47.1922638252534,47.2518014716056,47.3094310260653,47.3652136401040,47.4192085053803,47.4714729165495,47.5220623320592,47.5710304329976,47.6184291800548,47.6643088686589,47.7087181823454,47.7517042444158,47.7933126679407,47.8335876041606,47.8725717893352,47.9103065900913,47.9468320473179,47.9821869186536,48.0164087196131,48.0495337633953,48.0815971994159,48.1126330506048,48.1426742495080,48.1717526732332,48.1998991772748,48.2271436282550,48.2535149356159,48.2790410822952,48.3037491544199,48.3276653700473,48.3508151069855,48.3732229297221,48.3949126154898,48.4159071794967,48.4362288993484,48.4558993386866,48.4749393700708,48.4933691971266,48.5112083759834,48.5284758360266,48.5451898999830,48.5613683033636,48.5770282132831,48.5921862466760,48.6068584879292,48.6210605059489,48.6348073706816,48.6481136691045,48.6609935207045,48.6734605924598,48.6855281133427,48.6972088883570,48.7085153121252,48.7194593820409,48.7300527109993,48.7403065397199,48.7502317486739,48.7598388696298,48.7691380968290,48.7781392978026,48.7868520238422,48.7952855201350,48.8034487355738,48.8113503322530,48.8189986946596,48.8264019385708,48.8335679196650,48.8405042418584,48.8472182653726,48.8537171145456,48.8600076853909,48.8660966529152,48.8719904782014,48.8776954152642,48.8832175176866,48.8885626450436,48.8937364691194,48.8987444799262,48.9035919915295,48.9082841476870,48.9128259273069,48.9172221497305,48.9214774798469,48.9255964330423,48.9295833799916,48.9334425512961,48.9371780419729,48.9407938157997,48.9442937095213,48.9476814369205,48.9509605927591,48.9541346565919,48.9572069964596,48.9601808724619,48.9630594402175);
//        T      = 60;
//        N      = su.size().height;
//        alfa   = 1.0;

//        // Sería mejor poner unos valores acordes al modelo del quadrotor
//        Mat ym= (Mat_<double>(51,1) << 0,0.286419312605914,0.582855584008431,0.797606156445473,0.924594857252443,0.987005545881916,1.01078572776031,1.01533925638737,1.01240926707115,1.00791333791356,1.00420184847421,1.00180551328698,1.00051821261345,0.999956049164126,0.999787943556078,0.999794618966844,0.999855539583120,0.999916439690212,0.999959922138682,0.999985472818474,0.999998230452421,1.00000377640483,1.00000630292479,1.00000826761084,1.00000900567748,1.00000827400086,1.00000654052210,1.00000449444593,1.00000266728539,1.00000131439647,1.00000046353203,1.00000001687753,0.999999839372743,0.999999811186390,0.999999847821966,0.999999900014281,0.999999944841460,0.999999975459982,0.999999992944806,1.00000000109030,1.00000000372325,1.00000000368348,1.00000000270323,1.00000000165371,1.00000000086181,1.00000000036856,1.00000000009940,0.999999999968654,0.999999999915048,0.999999999902424,0.999999999910750);
//        Mat um= (Mat_<double>(51,1) << 0,0.727932988112189,1.03981034222468,1.12864289307856,1.12034718809542,1.08321125309130,1.04744273740750,1.02235849382066,1.00789270587829,1.00098288972163,0.998480609466058,0.998111576776092,0.998533846242748,0.999089477533578,0.999528809756031,0.999804909073038,0.999949448352615,1.00001031684492,1.00002695007569,1.00002485904018,1.00001789626966,1.00001232545764,1.00001019754037,1.00001129616277,1.00001014340284,1.00000714612566,1.00000386837485,1.00000134043163,0.999999850728237,0.999999228926193,0.999999151929533,0.999999328362270,0.999999565750160,0.999999767737293,0.999999904295489,0.999999980468426,1.00000001394229,1.00000002265825,1.00000001989756,1.00000001364654,1.00000000778193,1.00000000362218,1.00000000119217,1.00000000003587,0.999999999641115,0.999999999608210,0.999999999684506,0.999999999767103,0.999999999832416,0.999999999882964,0.999999999923583);

//        Mat ym2= (Mat_<double>(101,1) << 0,0.286419312605914,0.582855584008431,0.797606156445473,0.924594857252443,0.987005545881916,1.01078572776031,1.01533925638737,1.01240926707115,1.00791333791356,1.00420184847421,1.00180551328698,1.00051821261345,0.999956049164126,0.999787943556078,0.999794618966844,0.999855539583120,0.999916439690212,0.999959922138682,0.999985472818474,0.999998230452421,1.00000377640483,1.00000630292479,1.00000826761084,1.00000900567748,1.00000827400086,1.00000654052210,1.00000449444593,1.00000266728539,1.00000131439647,1.00000046353203,1.00000001687753,0.999999839372743,0.999999811186390,0.999999847821966,0.999999900014281,0.999999944841460,0.999999975459982,0.999999992944806,1.00000000109030,1.00000000372325,1.00000000368348,1.00000000270323,1.00000000165371,1.00000000086181,1.00000000036856,1.00000000009940,0.999999999968654,0.999999999915048,0.999999999902424,0.828148412364984,0.650286649543693,0.521436306099899,0.445243085630235,0.407796672462608,0.393528563341645,0.390796446168462,0.392554439759290,0.395251997253851,0.397478890917011,0.398916692028810,0.399689072432481,0.400026370501765,0.400127233866415,0.400123228619872,0.400086676250079,0.400050136185826,0.400024046716756,0.400008716308894,0.400001061728536,0.399997734157099,0.399996218245122,0.399995039433493,0.399994596593511,0.399995035599488,0.399996075686743,0.399997303332442,0.399998399628765,0.399999211362120,0.399999721880783,0.399999989873481,0.400000096376355,0.400000113288167,0.400000091306821,0.400000059991432,0.400000033095124,0.400000014724010,0.400000004233116,0.399999999345818,0.399999997766049,0.399999997789909,0.399999998378063,0.399999999007777,0.399999999482912,0.399999999778865,0.399999999940357,0.400000000018808,0.400000000050971,0.400000000058546,0.400000000053550,0.400000000042880);
//        Mat um2= (Mat_<double>(101,1) << 0,0.727932988112189,1.03981034222468,1.12864289307856,1.12034718809542,1.08321125309130,1.04744273740750,1.02235849382066,1.00789270587829,1.00098288972163,0.998480609466058,0.998111576776092,0.998533846242748,0.999089477533578,0.999528809756031,0.999804909073038,0.999949448352615,1.00001031684492,1.00002695007569,1.00002485904018,1.00001789626966,1.00001232545764,1.00001019754037,1.00001129616277,1.00001014340284,1.00000714612566,1.00000386837485,1.00000134043163,0.999999850728237,0.999999228926193,0.999999151929533,0.999999328362270,0.999999565750160,0.999999767737293,0.999999904295489,0.999999980468426,1.00000001394229,1.00000002265825,1.00000001989756,1.00000001364654,1.00000000778193,1.00000000362218,1.00000000119217,1.00000000003587,0.999999999641115,0.999999999608210,0.999999999684506,0.999999999767103,0.999999999832416,0.999999999882964,0.563240207088631,0.376113794645110,0.322814264148457,0.327791687146826,0.350073248152483,0.371534357562691,0.386584903713204,0.395264376476687,0.399410266169021,0.400911634321209,0.401133053934514,0.400879692254206,0.400546313479618,0.400282714146168,0.400117054556025,0.400030330988341,0.399993809893004,0.399983829954568,0.399985084575891,0.399989262238210,0.399992604725421,0.399993881475780,0.399993222302343,0.399993913958298,0.399995712324603,0.399997678975093,0.399999195741024,0.400000089563058,0.400000462644284,0.400000508842281,0.400000402982638,0.400000260549905,0.400000139357625,0.400000057422706,0.400000011718944,0.399999991634626,0.399999986405047,0.399999988061466,0.399999991812076,0.399999995330844,0.399999997826690,0.399999999284699,0.399999999978477,0.400000000215331,0.400000000235074,0.400000000189297,0.400000000139739,0.400000000100551,0.400000000070221,0.400000000045850,0.400000000026433);


//        { // Write to file
//        FileStorage fs("dmc_altitude_controller_configuration.yml", FileStorage::WRITE);
//        fs << "T_control_horizon"            << T;
//        fs << "N"                            << N;
//        fs << "su"                           << su;
//        fs << "alpha_response_time_parameter" << alfa;

//        fs << "measured_output"              << ym;  //measured output with reference=1
//        fs << "control moves"                << um;
//        fs << "measured_output_2"            << ym2; //measured output with reference =1 changing to reference=0.4 in time=50
//        fs << "control_moves_2"              << um2;

//        fs.release();
//        } // ~FileStorage();
//    }

    return 0;
}
